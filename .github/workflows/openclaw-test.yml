name: OpenClaw Integration Test

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  schedule:
    - cron: '0 * * * *'  # Run hourly
  workflow_dispatch:

jobs:
  openclaw-test:
    runs-on: self-hosted  # Target the self-hosted runner
    timeout-minutes: 30
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Display environment info
      run: |
        echo "=== OpenClaw Runner Environment ==="
        echo "Runner Name: $RUNNER_NAME"
        echo "Runner OS: $RUNNER_OS"
        echo "Runner Architecture: $RUNNER_ARCH"
        echo "Current Time: $(date)"
        echo "Working Directory: $(pwd)"
        
    - name: Test connectivity
      run: |
        echo "Testing network connectivity..."
        curl -s --max-time 10 https://httpbin.org/get
        echo "Connectivity test completed"
        
    - name: Demonstrate OpenClaw integration
      run: |
        echo "Simulating interaction with OpenClaw system..."
        echo "Current status: Operational"
        echo "Timestamp: $(date -u)"
        
        # Create a simple status report
        cat > openclaw-status-report-$(date +%Y%m%d-%H%M%S).txt << EOF
        OpenClaw Status Report
        ======================
        Timestamp: $(date -u)
        Status: Operational
        Runner: $RUNNER_NAME
        Job: ${{ github.job }}
        Repository: ${{ github.repository }}
        Event: ${{ github.event_name }}
        EOF
        
    - name: Test various tools availability
      run: |
        echo "Checking available tools..."
        if command -v node &> /dev/null; then
          echo "✓ Node.js: $(node --version)"
        else
          echo "✗ Node.js: Not found"
        fi
        
        if command -v npm &> /dev/null; then
          echo "✓ NPM: $(npm --version)"
        else
          echo "✗ NPM: Not found"
        fi
        
        if command -v python3 &> /dev/null; then
          echo "✓ Python3: $(python3 --version)"
        else
          echo "✗ Python3: Not found"
        fi
        
        if command -v git &> /dev/null; then
          echo "✓ Git: $(git --version)"
        else
          echo "✗ Git: Not found"
        fi
        
    - name: Create final report
      run: |
        echo "Creating final test report..."
        cat > final-report.md << EOF
        # OpenClaw Runner Test Report
        
        - **Job ID**: ${{ github.run_id }}
        - **Repository**: ${{ github.repository }}
        - **Triggered by**: ${{ github.actor }}
        - **Event type**: ${{ github.event_name }}
        - **Branch**: ${{ github.ref }}
        - **Runner**: $RUNNER_NAME
        - **Started at**: $(date -u)
        - **Status**: Success
        
        ## Summary
        This workflow ran successfully on the OpenClaw self-hosted runner.
        The runner is properly configured and operational.
        EOF
        
    - name: Upload artifacts
      uses: actions/upload-artifact@v4
      with:
        name: openclaw-test-report
        path: |
          *.txt
          final-report.md
          
    - name: Cleanup temporary files
      if: always()
      run: |
        rm -f openclaw-status-report-*.txt
        echo "Cleanup completed"